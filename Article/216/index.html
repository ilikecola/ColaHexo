<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      Hexo配置Deployment及Github相关操作 | Cola&#39;s Memory 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="ilikecola">
    
    

    <meta name="description" content="之前只是在本地对Hexo进行调试和修改，接下来我们需要部署到Github来备份以及部署到VPS来显示。同时我们也需要在Github上对源文件备份。本篇将会介绍如何部署Hexo到Github和VPS。">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo配置Deployment及Github相关操作 | Cola's Memory">
<meta property="og:url" content="http://colascarlet.moe/Article/216/index.html">
<meta property="og:site_name" content="Cola's Memory">
<meta property="og:description" content="之前只是在本地对Hexo进行调试和修改，接下来我们需要部署到Github来备份以及部署到VPS来显示。同时我们也需要在Github上对源文件备份。本篇将会介绍如何部署Hexo到Github和VPS。">
<meta property="og:updated_time" content="2016-11-21T17:22:11.275Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo配置Deployment及Github相关操作 | Cola's Memory">
<meta name="twitter:description" content="之前只是在本地对Hexo进行调试和修改，接下来我们需要部署到Github来备份以及部署到VPS来显示。同时我们也需要在Github上对源文件备份。本篇将会介绍如何部署Hexo到Github和VPS。">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/animsition.min.css">
    <link rel="stylesheet" href="/css/uno.css">
<!---    <link rel="stylesheet" href="/css/highlight.css"> --->
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">
    <link rel="stylesheet" href="/css/sons-of-obsidian.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed animsition">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        
        <a href="/" title="link to homepage for Cola&#39;s Memory"><img src="/avatar.png" width="80" alt="Cola&#39;s Memory logo" class="panel-cover__logo logo" /></a>
        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Cola&#39;s Memory</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          Just A Memorization
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                  
                    <li id="page-button-home" class="home_navigation__item navigation__item"><a style="cursor:pointer" title="" class="home-button">Home</a></li>
                                 
              
                  
                    <li id="page-button-blog" class="blog_navigation__item navigation__item"><a href="/#blog" title="" class="blog-button">Blog</a></li>
                                 
              
                  
                  	<li id="page-button-about" class="other_navigation__item navigation__item"><a href="/about" title="" class="other-button">About</a></li>
                                 
              
                  
                  	<li id="page-button-records" class="other_navigation__item navigation__item"><a href="/records" title="" class="other-button">Records</a></li>
                                 
              
                  
                  	<li id="page-button-ss" class="other_navigation__item navigation__item"><a href="https://ss.remiliascarlet.tk/auth/login" title="" class="other-button">Shadowsocks</a></li>
                                 
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li id="social-button-github" class="navigation__item" style="display:inline-block" >
        <a href="https://github.com/ilikecola" target="_blank" title="ilikecola on GitHub">
          <i class='icon icon-social-github'></i>
          <span class="label">GitHub</span>
        </a>
      </li>
    
    
    <li id="social-button-twitter" class="navigation__item" style="display:inline-block" >
        <a href="https://twitter.com/tkscarlet"  target="_blank" title="ilikecola on Twitter">
          <i class='icon icon-social-twitter'></i>
          <span class="label">Twitter</span>
        </a>
      </li>

    <!-- China social icon -->
    <!--
    
      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-douban'></i>
          <span class="label">Douban</span>
        </a>
      </li>
    -->
    
      <li id="social_button-weibo" class="navigation__item" style="display:inline-block" >
        <a href="http://weibo.com/2057404752"  target="_blank" title="ilikecola on Weibo">
          <i class='icon cs-icon-weibo'></i>
          <span class="label">Weibo</span>
        </a>
      </li>





  </ul>
</nav>



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>
		
    <div class="animsition content-wrapper-post">
    
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h0 class="post-title">Hexo配置Deployment及Github相关操作</h0>

    

    <div class="post-meta">
      <time datetime="2016-10-08" class="post-meta__date date">2016-10-08</time> 

      <span class="post-meta__tags tags">

          
            <font class="categories">
            &#8226; 分类:
            <a class="categories-link" href="/categories/Article/">Article</a>
            </font>
          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/Hexo/">Hexo</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <p>之前只是在本地对Hexo进行调试和修改，接下来我们需要部署到Github来备份以及部署到VPS来显示。<br>同时我们也需要在Github上对源文件备份。本篇将会介绍如何部署Hexo到Github和VPS。<br><a id="more"></a></p>
<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li>VPS和Nginx设置</li>
<li>Github设置</li>
<li>本机设置</li>
<li>更新Hexo</li>
</ul>
<h1 id="VPS和Nginx设置"><a href="#VPS和Nginx设置" class="headerlink" title="VPS和Nginx设置"></a>VPS和Nginx设置</h1><p>此处为<code>centos</code>在<code>root</code>下的操作，关于连接<code>VPS</code>，<code>Windows</code> 用户请使用Xshell。<br>关于<code>vi</code>操作，按下<code>ins</code>键进入编辑模式，编辑结束后按<code>esc</code>键退出，这时按<code>:</code>并输入<code>wq</code>，即可。</p>
<h2 id="安装Git"><a href="#安装Git" class="headerlink" title="安装Git"></a>安装Git</h2><pre><code>yum update &amp;&amp; apt-get upgrade -y #更新内核
yum install git-core
</code></pre><h2 id="设置SSH密钥"><a href="#设置SSH密钥" class="headerlink" title="设置SSH密钥"></a>设置SSH密钥</h2><pre><code>ssh-keygen -t rsa -C &quot;email@example.com&quot;#一路回车生成公钥和密钥，一会要用到公钥id_rsa.pub
</code></pre><p>并拷贝<code>id_rsa</code>文件到本地。</p>
<h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><pre><code>yum install nginx -y
</code></pre><h2 id="新建git用户添加sudo权限"><a href="#新建git用户添加sudo权限" class="headerlink" title="新建git用户添加sudo权限"></a>新建git用户添加sudo权限</h2><pre><code>adduser git
chmod 740 /etc/sudoers
vi /etc/sudoers
</code></pre><p>在vi编辑中找到如下内容：</p>
<blockquote>
<p>##Allow root to run any commands anywhere<br>root    ALL=(ALL)     ALL</p>
</blockquote>
<p>在下面添加一行</p>
<blockquote>
<p>git   ALL=(ALL)     ALL</p>
</blockquote>
<p>保存并退出后执行</p>
<pre><code>chmod 440 /etc/sudoers
</code></pre><h2 id="创建git仓库，并配置ssh登录"><a href="#创建git仓库，并配置ssh登录" class="headerlink" title="创建git仓库，并配置ssh登录"></a>创建git仓库，并配置ssh登录</h2><pre><code>su git
cd ~
mkdir .ssh &amp;&amp; cd .ssh
touch authorized_keys
vi authorized_keys//在这个文件中粘贴进刚刚申请的key（在id_rsa.pub文件中）
cd ~ 
mkdir hexo.git &amp;&amp; cd hexo.git
git init --bare
</code></pre><h2 id="创建网站目录并赋予git对网站目录的所有权"><a href="#创建网站目录并赋予git对网站目录的所有权" class="headerlink" title="创建网站目录并赋予git对网站目录的所有权"></a>创建网站目录并赋予git对网站目录的所有权</h2><pre><code>cd /var/www
mkdir hexo
chown git:git -R /var/www/hexo
</code></pre><h2 id="配置git-hooks"><a href="#配置git-hooks" class="headerlink" title="配置git hooks"></a>配置git hooks</h2><pre><code>su git
cd /home/git/hexo.git/hooks
vim post-receive
</code></pre><p>输入如下内容后保存退出，</p>
<pre><code>#!/bin/bash
GIT_REPO=/home/git/hexo.git #git仓库
TMP_GIT_CLONE=/tmp/hexo
PUBLIC_WWW=/var/www/hexo #网站目录
rm -rf ${TMP_GIT_CLONE}
git clone $GIT_REPO $TMP_GIT_CLONE
rm -rf ${PUBLIC_WWW}/*
cp -rf ${TMP_GIT_CLONE}/* ${PUBLIC_WWW}
</code></pre><p>然后赋予脚本的执行权限</p>
<pre><code>chmod +x post-receive
</code></pre><h2 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h2><pre><code>vi /etc/nginx/conf.d/hexo.conf

插入如下代码：
server {
    listen         80 ;
    root /var/www/hexo;//这里可以改成你的网站目录地址，我将网站放在/var/www/hexo
    server_name example.com www.example.com;//这里输入你的域名或IP地址
    access_log  /var/log/nginx/hexo_access.log;
    error_log   /var/log/nginx/hexo_error.log;
    location ~* ^.+\.(ico|gif|jpg|jpeg|png)$ {
            root /var/www/hexo;
            access_log   off;
            expires      1d;
    }
    location ~* ^.+\.(css|js|txt|xml|swf|wav)$ {
        root /var/www/hexo;
        access_log   off;
        expires      10m;
    }
    location / {
        root /var/www/hexo;//这里可以改成你的网站目录地址，我将网站放在/var/www/hexo
        if (-f $request_filename) {
            rewrite ^/(.*)$  /$1 break;
        }
    }
}
</code></pre><p>重启Nginx</p>
<pre><code>service nginx restart
</code></pre><h1 id="Github设置"><a href="#Github设置" class="headerlink" title="Github设置"></a>Github设置</h1><h2 id="设置SSH密钥-1"><a href="#设置SSH密钥-1" class="headerlink" title="设置SSH密钥"></a>设置SSH密钥</h2><p>首先同部署到VPS，需要在Github中设置SSH密钥。<br>使用<code>ssh-keygen</code>生成密钥并把<code>id_rsa.pub</code>中的公钥加入到github账户中<br>保留<code>id_rsa</code>文件到本地。<br>并且已经依照之前的文章创建了仓库。</p>
<h1 id="本机设置"><a href="#本机设置" class="headerlink" title="本机设置"></a>本机设置</h1><blockquote>
<p>如果使用<code>git</code>方式进行部署，执行<code>npm install hexo-deployer-git --save</code>来安装所需的插件</p>
</blockquote>
<h2 id="配置身份信息"><a href="#配置身份信息" class="headerlink" title="配置身份信息"></a>配置身份信息</h2><p>首先，你需要为自己配置身份信息，打开命令行，然后输入：</p>
<pre><code>git config --global user.name &quot;yourname&quot;
git config --global user.email &quot;youremail&quot;
</code></pre><h2 id="配置本地SSH密钥"><a href="#配置本地SSH密钥" class="headerlink" title="配置本地SSH密钥"></a>配置本地SSH密钥</h2><p>将从VPS下载的<code>id_rsa</code>文件以及github的<code>id_rsa</code>放置于<code>C:\Users\userename\.ssh\</code>,<br>在Git安装目录下的<code>cmd</code>文件夹中新建<code>inital.bat</code>文件内容为</p>
<pre><code>@echo off
if not &quot;%SSH_AGENT_PID%&quot; == &quot;&quot; goto end
for /f &quot;eol=; tokens=1,2 delims==;&quot; %%1 in (&#39;ssh-agent.exe&#39;) do (
 if &quot;%%1&quot; == &quot;SSH_AUTH_SOCK&quot; set SSH_AUTH_SOCK=%%2
 if &quot;%%1&quot; == &quot;SSH_AGENT_PID&quot; set SSH_AGENT_PID=%%2
)
ssh-add /C/Users/usrename/.ssh/id_rsa #放置id_rsa的位置，注意路径写法
ssh-add /C/Users/usrename/.ssh/id_rsa_github #github
ssh-add -l
:end
</code></pre><p>如果在<code>git bash</code>中依次输入</p>
<pre><code>eval $(ssh-agent -s)
ssh-add ~/.ssh/id_rsa #放置id_rsa的位置，注意路径写法
ssh-add ~/.ssh/id_rsa_github #github
ssh git@VPS的IP地址
## or
ssh -T git@github.com
</code></pre><p>能够远程登录的话，则表示设置成功了。</p>
<h2 id="配置hexo配置文件"><a href="#配置hexo配置文件" class="headerlink" title="配置hexo配置文件"></a>配置hexo配置文件</h2><p>位于<code>hexo</code>文件夹下，<code>_config.yml</code>,修改<code>deploy</code>选项</p>
<pre><code> deploy:
   type: git
   message: update
   repo:
     s1: git@VPS的ip地址或域名:git仓库地址,master
 ##例如
 deploy:
   type: git
   message: update
   repo:
     s1: git@192.234.35.236:hexo.git,master
</code></pre><p>deploy可以多个参数，即：可以同时<code>push</code>到github和VPS</p>
<h1 id="更新Hexo"><a href="#更新Hexo" class="headerlink" title="更新Hexo"></a>更新Hexo</h1><p>接着在<code>hexo</code>文件夹内，打开命令行，首先运行<code>inital.bat</code>，再运行<code>hexo g -d</code>，如果一切正常，静态文件已经被成功的<code>push</code>到了<code>blog</code>的仓库里，如果出现<code>appears not to be a git repo</code>的错误，删除<code>hexo</code>目录下的<code>.deploy</code>后再次<code>hexo g -d</code>就可以了。</p>
<p>Reference：</p>
<blockquote>
<p><a href="http://tiktoking.github.io/2016/01/26/hexo/" target="_blank" rel="external">http://tiktoking.github.io/2016/01/26/hexo/</a><br><a href="https://xuanwo.org/2015/03/26/hexo-intor/" target="_blank" rel="external">https://xuanwo.org/2015/03/26/hexo-intor/</a><br><a href="http://crazymilk.github.io/2015/12/28/GitHub-Pages-Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/#more" target="_blank" rel="external">http://crazymilk.github.io/2015/12/28/GitHub-Pages-Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/#more</a><br><a href="https://help.github.com/articles/generating-an-ssh-key/" target="_blank" rel="external">https://help.github.com/articles/generating-an-ssh-key/</a></p>
</blockquote>
<p>本文地址: <a href="http://colascarlet.moe/Article/216/">http://colascarlet.moe/Article/216/</a> 转载请注明</p>

  </section>

  
  
</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/main.js"></script>
    <script type="text/javascript" src="/js/scale.fix.js"></script>
    <script type="text/javascript" src="/js/animsition.min.js"></script>
    <script type="text/javascript" src="/js/prettify/prettify.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                displayNow: false,
                autoDetectHeadings: true,
                contentId: "post-content",
            });
        });
    </script>


    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-91753519-1', 'auto');
  ga('send', 'pageview');

</script>
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
